// Generated by CoffeeScript 1.4.0

/**
 * @package		Photo gallery
 * @category	modules
 * @author		Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @copyright	Copyright (c) 2013, Nazar Mokrynskyi
 * @license		MIT License, see license.txt
*/


(function() {

  $(function() {
    var add_button, images_section;
    add_button = $('.cs-photo-gallery-add-images');
    if (add_button.length) {
      window.uploader = file_upload(add_button, function(files) {
        return $.ajax(base_url + '/api/Photo_gallery/add_images', {
          cache: false,
          data: {
            files: files,
            gallery: add_button.data('gallery')
          },
          success: function(result) {
            if (!result.length || !result) {
              alert(L.photo_gallery_images_not_supported);
            }
            if (files.length !== result.length) {
              alert(L.photo_gallery_some_images_not_supported);
            }
            return location.href = location.href + '/' + result.join(',');
          },
          error: function(xhr) {
            return alert(xhr.responseText ? json_decode(xhr.responseText).error_description : L.photo_gallery_images_addition_connection_error);
          }
        });
      }, function(error) {
        return alert(error);
      }, null, true);
    }
    images_section = $('.cs-photo-gallery-images');
    if (images_section.length) {
      $('html, body').stop().animate({
        scrollTop: $('.cs-photo-gallery-images').offset().top - $(document).height() * .1
      });
      $(document).on('click', '.cs-photo-gallery-image-edit', function() {
        return location.href = location.href + '/' + $(this).data('image');
      }).on('click', '.cs-photo-gallery-image-delete', function() {
        if (confirm(L.photo_gallery_sure_to_delete_image)) {
          return $.ajax(base_url + '/api/Photo_gallery/delete_image', {
            cache: false,
            data: {
              image: $(this).data('image')
            },
            success: function() {
              return location.reload();
            },
            error: function(xhr) {
              return alert(xhr.responseText ? json_decode(xhr.responseText).error_description : L.photo_gallery_images_deletion_connection_error);
            }
          });
        }
      });
    }
    return $('.cs-photo-gallery-delete-image-checkbox').change(function() {
      var t;
      t = $(this);
      return t.parentsUntil('section').find('img, :text, textarea, p').animate({
        opacity: t.is(':checked') ? .2 : 1
      });
    });
  });

}).call(this);
