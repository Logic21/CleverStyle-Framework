// Generated by LiveScript 1.4.0
/**
 * @package   Photo gallery
 * @category  modules
 * @author    Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @copyright Copyright (c) 2013-2017, Nazar Mokrynskyi
 * @license   MIT License, see license.txt
 */
(function(){
  require(['jquery'], function($){
    $(function(){
      var add_button, images_section;
      add_button = document.querySelector('.cs-photo-gallery-add-images');
      if (add_button) {
        cs.file_upload(add_button, function(files){
          var gallery;
          gallery = add_button.dataset.gallery;
          Promise.all([
            cs.api('post api/Photo_gallery/images', {
              files: files,
              gallery: gallery
            }), cs.Language('photo_gallery_').ready()
          ]).then(function(arg$){
            var result, L, href;
            result = arg$[0], L = arg$[1];
            if (!result.length || !result) {
              cs.ui.alert(L.images_not_supported);
              return;
            }
            href = 'Photo_gallery/edit_images/' + result.join(',');
            if (files.length !== result.length) {
              cs.ui.alert(L.some_images_not_supported).then(function(){
                location.href = href;
              });
            } else {
              location.href = href;
            }
          });
        }, null, null, true);
      }
      images_section = document.querySelector('.cs-photo-gallery-images');
      if (images_section) {
        $('html, body').stop().animate({
          scrollTop: $('.cs-photo-gallery-images').offset().top - $(document).height() * 0.1
        });
        cs.ui.ready.then(function(){
          $(images_section).fotorama({
            allowfullscreen: 'native',
            controlsonstart: false,
            fit: 'scaledown',
            height: '80%',
            keyboard: true,
            nav: 'thumbs',
            trackpad: true,
            width: '100%'
          });
        });
        $('body').on('click', '.cs-photo-gallery-image-delete', function(){
          var this$ = this;
          cs.Language('photo_gallery_').ready().then(function(L){
            return cs.ui.confirm(L.sure_to_delete_image);
          }).then(function(){
            return cs.api('delete api/Photo_gallery/images/' + $(this$).data('image'));
          }).then(bind$(location, 'reload'));
        });
      }
    });
  });
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);
